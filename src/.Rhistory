# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear)* 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear),
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = weighted.mean(birth_lastyear, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = weighted.mean(birth_lastyear, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear, na.rm = TRUE)
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear, na.rm = TRUE)
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear, na.rm = TRUE),
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear, na.rm = TRUE)/10,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
library(tidyverse)
library(lubridate)
library(ggplot2)
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = weighted.mean(birth_lastyear, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear * ASECWT, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear * ASECWT, na.rm = TRUE)
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear * ASECWT, na.rm = TRUE),
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear * ASECWT, na.rm = TRUE) /
sum(ASECWT, na.rm = TRUE),
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = sum(birth_lastyear * ASECWT, na.rm = TRUE) /
sum(ASECWT, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = weighted.mean(birth_lastyear, ASECWT, na.rm = TRUE)* 1000,
emp_rate   = weighted.mean(employed, ASECWT, na.rm = TRUE) * 100
) %>%
ungroup()
# Plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate,
color = factor(ever_treated, levels = c(1, 0),
labels = c("Treated states", "Never treated states")))) +
geom_line(size = 1) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
labs(
title = "Average Annual Birth Rates by Treatment Status",
x = "Year", y = "Average Births per 1,000 Women", color = "Group"
) +
scale_color_manual(values = c("firebrick", "steelblue")) +
theme_minimal(base_size = 13) +
theme(panel.grid.minor = element_blank(), legend.position = "bottom")
df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(total_weight = sum(ASECWT, na.rm = TRUE))
df_stateyear
ggdid(agg_dyn_NYT)
# Import packages
library(tidyverse)
library(lubridate)
library(did)
summary(att_cs_NT)
ggdid(agg_dyn_NT)
summary(att_cs_NT)
summary(agg_dyn_NT)
ggdid(agg_dyn_NT)
ggdid(agg_dyn_NYT)
ggdid(agg_dyn_NT_employment)
# Import packages
library(tidyverse)
library(lubridate)
library(did)
# Import cleaned data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Remove all observations where year > repeal year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year) %>%
filter(ASECWT != 0)
colnames(df1)
# For never-treated units, we set treat_start_year to be 0, to be consistent with how the package wants it
df1$treat_start_year[is.na(df1$treat_start_year)] <- 0
att_cs_NT <- readRDS("../modelresults/att_cs_NT.rds") # instead of re-running, load this
summary(att_cs_NT)
agg_dyn_NT <- aggte(att_cs_NT, type = "simple")
agg_dyn_NT
summary(agg_simple_NT)
agg_simple_NT <- aggte(att_cs_NT, type = "simple")
summary(agg_simple_NT)
summary(agg_simple_NT)
# Saving so we don't have to rerun it and wait everytime
#saveRDS(att_cs_NT, "../modelresults/att_cs_NT.rds")
#saveRDS(agg_dyn_NT, "../modelresults/agg_dyn_NT.rds")
saveRDS(agg_simple_NT, "../modelresults/agg_simple_NT.rds")
# Saving so we don't have to rerun it and wait everytime
#saveRDS(att_cs_NT, "../modelresults/cs/att_cs_NT.rds")
#saveRDS(agg_dyn_NT, "../modelresults/cs/agg_dyn_NT.rds")
saveRDS(agg_simple_NT, "../modelresults/cs/agg_simple_NT.rds")
att_cs_NT <- readRDS("../modelresults/att_cs_NT.rds") # instead of re-running, load this
att_cs_NT <- readRDS("../modelresults/cs/att_cs_NT.rds") # instead of re-running, load this
summary(att_cs_NT)
agg_dyn_NT <- readRDS("../modelresults/cs/agg_dyn_NT.rds") # instead of re-running, load this
# Import packages
library(tidyverse)
library(lubridate)
library(did)
# Import cleaned data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Remove all observations where year > repeal year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year) %>%
filter(ASECWT != 0)
colnames(df1)
# For never-treated units, we set treat_start_year to be 0, to be consistent with how the package wants it
df1$treat_start_year[is.na(df1$treat_start_year)] <- 0
att_cs_NYT <- readRDS("../modelresults/cs/att_cs_NYT.rds") # instead of re-running, load this
summary(att_cs_NYT)
agg_simple_NYT <- aggte(att_cs_NYT, type = "simple")
agg_simple_NYT <- readRDS("../modelresults/cs/agg_simple_NYT.rds")
agg_simple_NYT <- aggte(att_cs_NYT, type = "simple")
#saveRDS(att_cs_NYT, "../modelresults/cs/att_cs_NYT.rds")
#saveRDS(agg_dyn_NYT, "../modelresults/cs/agg_dyn_NYT.rds")
saveRDS(agg_simple_NYT, "../modelresults/cs/agg_simple_NYT.rds")
summary(agg_simple_NYT)
agg_simple_NYT <- readRDS("../modelresults/cs/agg_simple_NYT.rds")
summary(agg_simple_NYT)
# Import packages
library(tidyverse)
library(lubridate)
library(did)
# Import cleaned data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Remove all observations where year > repeal year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year) %>%
filter(ASECWT != 0)
colnames(df1)
# For never-treated units, we set treat_start_year to be 0, to be consistent with how the package wants it
df1$treat_start_year[is.na(df1$treat_start_year)] <- 0
att_cs_NT <- readRDS("../modelresults/cs/att_cs_NT.rds") # instead of re-running, load this
agg_dyn_NT <- aggte(att_cs_NT, type = "dynamic")
# Import packages
library(tidyverse)
library(lubridate)
library(did)
# Import cleaned data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Remove all observations where year > repeal year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year) %>%
filter(ASECWT != 0)
colnames(df1)
# For never-treated units, we set treat_start_year to be 0, to be consistent with how the package wants it
df1$treat_start_year[is.na(df1$treat_start_year)] <- 0
res <- readRDS("../modelresults/cs/anticipation.rds") # instead of re-running, load this
anticipationResults <- res %>%
mutate(
upperbound = att + 1.96 * se,
lowerbound = att - 1.96 * se,
anticipation = factor(anticipation, levels = sort(unique(anticipation)))
)
ggplot(anticipationResults, aes(event_time, att, color = anticipation, group = anticipation)) +
geom_hline(yintercept = 0, linetype = "dashed") +
geom_ribbon(aes(ymin = lowerbound, ymax = upperbound, fill = anticipation), alpha = 0.15, color = NA) +
geom_line(size = 1) +
geom_point(size = 1.6) +
labs(x = "Event time (years since treatment)",
y = "ATT(g,t) — dynamic",
color = "Anticipation (k)",
fill  = "Anticipation (k)",
title = "Event-study ATTs across anticipation windows") +
theme_minimal(base_size = 12)
