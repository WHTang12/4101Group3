knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(did)
df <- readRDS("../cleaned_data/finalmerged.rds")
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
head(df1)
col.names(df1)
colnames(df1)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "STATEFIP",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
summary(att_cs)
agg_cs <- aggte(att_cs, type = "group")
agg_dyn <- aggte(att_cs, type = "dynamic")
summary(agg_dyn)
ggdid(agg_dyn)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "STATEFIP",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
summary(att_cs)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "STATEFIP",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE + median_weekly_wage,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "STATEFIP",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "STATEFIP",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
table(duplicated(df_final$CPSID))
table(duplicated(df1$CPSID))
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "obs_id",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
df1$obs_id <- 1:nrow(df1)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
idname  = "obs_id",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
summary(att_cs)
summary(agg_cs)
agg_cs <- aggte(att_cs, type = "group")
summary(agg_cs)
agg_dyn <- aggte(att_cs, type = "dynamic")
summary(agg_dyn)
ggdid(agg_dyn)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE + median_weekly_wage,
control_group = "notyettreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE + median_weekly_wage,
control_group = "nevertreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
unique(df_final$STATE[is.na(df_final$treat_start_year)])
unique(df1$STATE[is.na(df_final$treat_start_year)])
unique(df1$STATE[is.na(df1$treat_start_year)])
df1$treat_start_year[is.na(df1$treat_start_year)] <- 0
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE + median_weekly_wage,
control_group = "nevertreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST + UNEMPLOYMENTRATE,
control_group = "nevertreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "nevertreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
att_cs <- att_gt(
yname   = "birth_lastyear",
tname   = "YEAR",
gname   = "treat_start_year",
xformla = ~ AGE + NCHILD + EDUC + RACE + MARST,
control_group = "nevertreated",
weightsname = "ASECWT",
data    = df1,
panel = F,
clustervars = "STATEFIP"
)
agg_dyn <- aggte(att_cs, type = "dynamic")
summary(agg_dyn)
ggdid(agg_dyn)
