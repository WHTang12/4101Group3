# Employment rate plot (no legend)
p2 <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(x = "Year", y = "Employment Rate (%)") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none"
)
# Combine side-by-side
combined_plot <- (p1 | p2) +
plot_layout(guides = "collect") &
theme(
legend.position = c(0.05, 0.95),    # top-left inside
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.key.width = unit(1.5, "lines"),
legend.key.height = unit(1.2, "lines")
)
# Add unified title + subtitle
combined_plot <- combined_plot +
plot_annotation(
title = "Trends in Birth and Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
theme = theme(
plot.title = element_text(face = "bold", size = 17, hjust = 0.5),
plot.subtitle = element_text(size = 12, colour = "grey30", hjust = 0.5)
)
)
# Show plot
combined_plot
color_scale <- scale_color_manual(
values = c("Treated states" = "firebrick", "Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
)
# Birth rate plot (keep legend ON)
p1 <- ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(x = "Year", y = "Births per 1,000 Women", color = NULL) +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(panel.grid.minor = element_blank())
# Employment rate plot (legend OFF)
p2 <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(x = "Year", y = "Employment Rate (%)") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none"
)
# Combine plots with one legend
combined_plot <- (p1 | p2) +
plot_layout(guides = "collect") &
theme(
legend.position = c(0.05, 0.95),    # inside top-left
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_blank(),
legend.text = element_text(size = 11),
legend.key.width = unit(1.5, "lines"),
legend.key.height = unit(1.2, "lines")
)
# Add title and subtitle
combined_plot <- combined_plot +
plot_annotation(
title = "Trends in Birth and Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
theme = theme(
plot.title = element_text(face = "bold", size = 17, hjust = 0.5),
plot.subtitle = element_text(size = 12, colour = "grey30", hjust = 0.5)
)
)
# Show the final plot
combined_plot
ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Annual Birth Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Births per 1,000 Women",
color = "Treatment status"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top",
title.hjust = 0.5,
nrow = 2,
byrow = TRUE,
override.aes = list(size = 4),
keywidth = 1.8,
keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),        # inside, top-left corner
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 11),
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
birth_plot <- ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Annual Birth Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Births per 1,000 Women",
color = "Treatment status"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top",
title.hjust = 0.5,
nrow = 2,
byrow = TRUE,
override.aes = list(size = 4),
keywidth = 1.8,
keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),        # inside, top-left corner
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 11),
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
ggsave(
filename = "birth_rate_treated_vs_control.png",
plot = birth_plot,
width = 10,
height = 6,
dpi = 600,
units = "in",
bg = "white"
)
ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Employment Rate (%)",
color = "Treatment Status"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top",
title.hjust = 0.5,
nrow = 2,
byrow = TRUE,
override.aes = list(size = 4),
keywidth = 1.8,
keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 11),
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Employment Rate (%)"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
employment_plot <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Employment Rate (%)"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
ggsave(
filename = "employment_treated_vs_control.png",
plot = employment_plot,
width = 10,
height = 6,
dpi = 600,
units = "in",
bg = "white"
)
combined <- birth_plot | employment_plot
combined
combined <- (birth_plot | employment_plot) +
plot_annotation(
title = "Birth & Employment Rates by Treatment Status",
theme = theme(plot.title = element_text(face="bold", size=18, hjust=0.5))
)
combined
employment_plot <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
geom_vline(xintercept = 1992, linetype = "dashed", color = "black") +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
title = "Average Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
x = "Year", y = "Employment Rate (%)"
) +
scale_color_manual(
values = c("Treated states" = "firebrick",
"Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
) +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.title = element_text(face = "bold", size = 17),
plot.subtitle = element_text(size = 12, colour = "grey30")
)
combined <- birth_plot | employment_plot
combined
ggsave("combined_birth_employment.png", combined,
width = 14, height = 6.5, dpi = 600, units = "in", bg = "white")
color_scale <- scale_color_manual(
values = c("Treated states" = "firebrick", "Never treated states" = "steelblue"),
labels = c("Treated", "Never treated")
)
# Birth rate plot (no legend, smaller subtitle)
p1 <- ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
subtitle = "Birth rates",
x = "Year", y = "Births per 1,000 Women"
) +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# Employment rate plot (legend inside top-left, smaller subtitle)
p2 <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(
subtitle = "Employment rates",
x = "Year", y = "Employment Rate (%)",
color = "Treatment status"
) +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top",
title.hjust = 0.5,
nrow = 2,
byrow = TRUE,
override.aes = list(size = 4),
keywidth = 1.8,
keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text = element_text(size = 11),
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# Combine plots side-by-side
combined <- (p1 | p2) +
plot_annotation(
title = "Trends in Birth and Employment Rates by Treatment Status",
theme = theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5)
)
)
# Add one global dashed line
combined <- combined & geom_vline(xintercept = 1992, linetype = "dashed", color = "black")
# Display
combined
color_scale <- scale_color_manual(
values = c("Treated states" = "firebrick", "Never treated states" = "steelblue"),
labels  = c("Treated", "Never treated")
)
# LEFT: Birth plot (legend ON, boxed inside)
p_left <- ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(subtitle = "Birth rates", x = "Year", y = "Births per 1,000 Women", color = "Treatment status") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top", title.hjust = 0.5,
nrow = 2, byrow = TRUE,
override.aes = list(size = 4), keywidth = 1.8, keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text  = element_text(size = 11),
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# RIGHT: Employment plot (legend OFF)
p_right <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(subtitle = "Employment rates", x = "Year", y = "Employment Rate (%)") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# Combine, add single dashed line and global title + subtitle
combined <- (p_left | p_right) +
plot_annotation(
title = "Trends in Birth and Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
theme = theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
plot.subtitle = element_text(size = 12, colour = "grey30", hjust = 0.5)
)
) &
geom_vline(xintercept = 1992, linetype = "dashed", color = "black")
combined
# This file is just for plotting the pre-trends used in presentation/report.
# There are no models/analysis done, so you can ignore.
library(tidyverse)
library(lubridate)
library(ggplot2)
library(patchwork)
#install.packages("patchwork")
# Import data
df <- readRDS("../cleaned_data/finalmerged.rds")
# Filter only for years where it's before repeal_year
df1 <- df %>%
filter(is.na(repeal_year) | YEAR <= repeal_year)
# Compute birth rates and employment rate for each (ever_treated, year) by taking weighted means
df_stateyear <- df1 %>%
group_by(YEAR, ever_treated) %>%
summarise(
birth_rate = weighted.mean(birth_lastyear, w = ASECWT, na.rm = TRUE) * 1000,
emp_rate   = weighted.mean(employed,     w = ASECWT, na.rm = TRUE) * 100
, .groups = "drop") %>%
mutate(group = if_else(ever_treated == 1, "Treated states", "Never treated states"))
##### Plotting #####
color_scale <- scale_color_manual(
values = c("Treated states" = "firebrick", "Never treated states" = "steelblue"),
labels  = c("Treated", "Never treated")
)
# Birth rate plot
birth_plot <- ggplot(df_stateyear, aes(x = YEAR, y = birth_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(subtitle = "Birth rates", x = "Year", y = "Births per 1,000 Women", color = "Treatment status") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
guides(color = guide_legend(
title.position = "top", title.hjust = 0.5,
nrow = 2, byrow = TRUE,
override.aes = list(size = 4), keywidth = 1.8, keyheight = 1.2
)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = c(0.05, 0.95),
legend.justification = c(0, 1),
legend.background = element_rect(fill = "white", color = "gray70", linewidth = 0.6),
legend.box.background = element_rect(fill = "white", color = "gray60", linewidth = 0.6),
legend.margin = margin(8, 8, 8, 8),
legend.title = element_text(size = 12, face = "bold"),
legend.text  = element_text(size = 11),
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# Employment plot
employment_plot <- ggplot(df_stateyear, aes(x = YEAR, y = emp_rate, color = group)) +
geom_line(size = 1.2) +
annotate("rect", xmin = 1992, xmax = 2011, ymin = -Inf, ymax = Inf, alpha = 0.08) +
labs(subtitle = "Employment rates", x = "Year", y = "Employment Rate (%)") +
color_scale +
scale_x_continuous(breaks = pretty_breaks(n = 7)) +
scale_y_continuous(breaks = pretty_breaks(n = 6)) +
theme_minimal(base_size = 15) +
theme(
panel.grid.minor = element_blank(),
legend.position = "none",
plot.subtitle = element_text(size = 12, face = "bold", hjust = 0.5)
)
# Combined
combined <- (birth_plot | employment_plot) +
plot_annotation(
title = "Trends in Birth and Employment Rates by Treatment Status",
subtitle = "Dashed line marks start of first Family Cap adoption (1992)",
theme = theme(
plot.title = element_text(face = "bold", size = 18, hjust = 0.5),
plot.subtitle = element_text(size = 12, colour = "grey30", hjust = 0.5)
)
) &
geom_vline(xintercept = 1992, linetype = "dashed", color = "black")
combined
ggsave("combined_birth_employment_final.png", combined,
width = 14, height = 6.5, dpi = 600, units = "in", bg = "white")
ggsave("combined_birth_employment_plots.png", combined,
width = 14, height = 6.5, dpi = 600, units = "in", bg = "white")
