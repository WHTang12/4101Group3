---
title: "CPS Indiv Data Cleaning"
author: "DSE Group 3"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(lubridate)
```
**Importing Data**
```{r}
rawCPS <- read_csv("../data/cps_00004.csv", show_col_types = FALSE)

head(rawCPS)
```

**Filter for Unmarried (Not 1, 2) women (2) aged between 18 and 45 with at most a high school degree (<= 73)**
```{r}
CPS1 <- rawCPS %>%
  filter(SEX == 2, AGE >= 18, AGE <= 45, EDUC <= 73, (MARST %in% c(3, 4, 5, 6, 7)))
```

```{r}
colSums(is.na(CPS1))
```


```{r}
summary(CPS1)
```
**NA's in UHRSWORKT is pre 1994, so not big issue (for now)**
```{r}
CPS1 %>%
  group_by(YEAR) %>%
  summarise(
    n_total = n(),
    n_na = sum(is.na(UHRSWORKT)),
    share_na = mean(is.na(UHRSWORKT))
  )
```
**Cleaning "Total Hours Worked last week" Variable**
```{r}
CPS2 <- CPS1 %>%
  mutate(
    UHRSWORKT = case_when(
      UHRSWORKT == 997 ~ NA_real_,    # hours vary -> NA
      UHRSWORKT == 999 ~ 0,            # not applicable means 0
      TRUE ~ UHRSWORKT
    )
  )
```
**Creating outcome variables of interest**
```{r}
CPS3 <- CPS2 %>%
  mutate(
    employed = ifelse(EMPSTAT %in% c(10, 12), 1, 0), # creating "employed" outcome indicator
    birth_lastyear = ifelse(YNGCH <= 1, 1, 0) # creating "fertility" outcome indicator
  )

table(CPS3$birth_lastyear)
table(CPS3$employed)
```
**Creating Race Dummies**
```{r}
table(CPS3$RACE)
```
```{r}
CPS4 <- CPS3 %>%
  mutate(
    black = if_else(RACE == 200, 1, 0),
    white = if_else(RACE == 100, 1, 0),
    other = if_else(!RACE %in% c(100, 200), 1, 0)
  )

colSums(is.na(CPS4))
```
**Save cleaned data**
```{r}
#saveRDS(CPS4, "../cleaned_data/indivCPS.rds")
```


